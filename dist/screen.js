function init(){db.ready?(console.log("Db started, init layout"),c.onRespons(onNewData),initLayout(),initBackground()):setTimeout(init,250)}function onNewData(e){changeLayoutItem(e.name,e.value)}function initBackground(){document.querySelectorAll("p,li,span,code,dd,dt,dl,th,td").forEach(function(e){e.onmouseover=function(e){if(enableBackground){console.log("in"),cscreen.setVisible(!0);var t=GetPos(e.target);cscreen.X=t.X,cscreen.Y=t.Y,cscreen.width=t.Width,cscreen.height=t.Height,cscreen.resetPos()}else cscreen.setVisible(!1)}})}function initLayout(){for(var e in db.settings)e.startsWith("_")||db.Get(e,function(e){var t={},s={};for(s in e)t=e[s];createLayoutItem(s,t.value)})}function createLayoutItem(e,t){if(void 0!=prefabStyle[e]){var s=document.createElement("style");s.setAttribute("data",e),document.head.appendChild(s),styleElements.push(s)}changeLayoutItem(e,t)}function changeLayoutItem(e,t){switch(settings[e]=t,e){case"dyslexic":if(toBool(t)){for(var s in styleElements)(settings.screen||"color"!=styleElements[s].getAttribute("data"))&&(settings.font||"font"!=styleElements[s].getAttribute("data"))&&(settings.markup||"markup"!=styleElements[s].getAttribute("data"))?styleElements[s].disabled=!1:styleElements[s].disabled=!0;enableBackground=!!settings.screen}else{for(var s in styleElements)styleElements[s].disabled=!0;enableBackground=!1}break;case"font":for(var s in styleElements)if("font"==styleElements[s].getAttribute("data")){n=document.createTextNode(prefabStyle.font);if(styleElements[s].childNodes[0]&&styleElements[s].removeChild(styleElements[s].childNodes[0]),styleElements[s].appendChild(n),!settings.dyslexic){styleElements[s].disabled=!0;break}0==toBool(t)?styleElements[s].disabled=!0:styleElements[s].disabled=!1;break}break;case"markup":for(var s in styleElements)if("markup"==styleElements[s].getAttribute("data")){n=document.createTextNode(prefabStyle.markup);if(styleElements[s].childNodes[0]&&styleElements[s].removeChild(styleElements[s].childNodes[0]),styleElements[s].appendChild(n),!settings.dyslexic){styleElements[s].disabled=!0;break}0==toBool(t)?styleElements[s].disabled=!0:styleElements[s].disabled=!1;break}break;case"screen":if(toBool(t)){for(var s in styleElements)if(settings.dyslexic&&"color"==styleElements[s].getAttribute("data")){styleElements[s].disabled=!1,enableBackground=!0;break}}else{for(var s in styleElements)if("color"==styleElements[s].getAttribute("data")){styleElements[s].disabled=!0;break}enableBackground=!1}break;case"color":for(var s in styleElements)if("color"==styleElements[s].getAttribute("data")){n=document.createTextNode(prefabStyle.color.format([t]));styleElements[s].childNodes[0]&&styleElements[s].removeChild(styleElements[s].childNodes[0]),styleElements[s].appendChild(n),settings.screen&&settings.dyslexic||(styleElements[s].disabled=!0);break}break;case"opacity":for(var s in styleElements)if("opacity"==styleElements[s].getAttribute("data")){var n=document.createTextNode(prefabStyle.opacity.format([t]));styleElements[s].childNodes[0]&&styleElements[s].removeChild(styleElements[s].childNodes[0]),styleElements[s].appendChild(n),settings.screen&&settings.dyslexic||(styleElements[s].disabled=!0);break}}}function toBool(e){switch(e){case"true":return!0;case"false":case!1:return!1;case!0:return!0;default:return!1}}function GetPos(e){var t=document.getElementsByName("body")[0],s={};for(s.X=e.offsetLeft,s.Y=e.offsetTop,s.Width=e.offsetWidth,s.Height=e.offsetHeight;e.offsetParent;){var n=e.offsetParent;if(s.X+=n.offsetLeft,s.Y+=n.offsetTop,e==t)break;e=e.offsetParent}return s}var c=new Client,db=new Db,styleElements=[],settings={},cscreen=new CScreen,enableBackground=!1,prefabStyle={font:'*, html, body, h1, h2, h3, h4, h5, h6, p, span, div, code{font-family: "OpenDyslexic" !important; line-height: 150%;} code,pre{font-family: OpenDyslexicMono !important;}',color:"#"+cscreen.id+" {background: {0} !important;}",opacity:"#"+cscreen.id+" {opacity: {0} !important;}",markup:"p, span, div, code { text-align: justify !important;text-justify: inter-word !important;background: white !important;color: #333 !important;line-height: 1.5 !important;font-size: 1em !important;}"};init(),String.prototype.format=function(e){return this.replace(String.prototype.format.regex,function(t){var s=parseInt(t.substring(1,t.length-1));return s>=0?e[s]:-1===s?"{":-2===s?"}":""})},String.prototype.format.regex=new RegExp("{-?[0-9]+}","g");