function init(){db.ready?(console.log("Db started, Init menu"),createMenu(),$("a").on("click",function(){return chrome.tabs.create({url:$(this).attr("href")}),!1})):setTimeout(init,250)}function createMenu(){for(var e in db.settings)e.startsWith("_")||(counter++,db.Get(e,function(e){var t={},a={};for(a in e)t=e[a];settings[a]=t,counter--,elementData.push(addElement(t.label,t.value,t.type,t.help,t.spacer,a))}));canStartToggle()}function canStartToggle(){if(0==counter)for(var e=elementData.length-1;e>=0;e--)toggleData(elementData[e].childNodes[1].childNodes[0].getAttribute("data"),settings[elementData[e].childNodes[1].childNodes[0].getAttribute("data")].value);else setTimeout(canStartToggle,100)}function addElement(e,t,a,n,i,r){var d=document.createElement("tr"),l=document.createElement("td"),o=document.createElement("td"),c=document.createElement("input");l.className="text",l.setAttribute("title",n);for(var u=0;u<i;u++){var s=document.createTextNode("  ");l.appendChild(s)}return l.appendChild(document.createTextNode(e)),o.className="input",c.type=a,"range"==a?(c.setAttribute("max",100),c.setAttribute("min",0),c.value=normalizeInput(100*t)):"checkbox"==a?c.checked=normalizeInput(t):c.value=normalizeInput(t),c.setAttribute("data",r),c.onchange=onChangeSet,o.appendChild(c),d.appendChild(l),d.appendChild(o),wrapper.appendChild(d),d}function onChangeSet(e){var t="checkbox"==e.target.type?e.target.checked:e.target.value;t="range"==e.target.type?e.target.value/100:t,settings[e.target.getAttribute("data")].value=t,toggleData(e.target.getAttribute("data"),t),db.Set(e.target.getAttribute("data"),t),(new Server).Send(e.target.getAttribute("data"),t)}function normalizeInput(e){return isNumeric(e)?parseFloat(e):isBool(e)?"true"==String(e):e}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function isBool(e){switch(e){case"true":case"false":return!0;default:return!1}}function toggleData(e,t){if("dyslexic"==e)if(0==t)for(var a in elementData)"dyslexic"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")&&$(elementData[a]).slideUp({duration:100});else for(var a in elementData)"dyslexic"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")&&(normalizeInput(settings.screen.value)||"color"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")&&"opacity"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data"))&&$(elementData[a]).slideDown({duration:100});if("screen"==e)if(0==t)for(var a in elementData)"color"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")&&"opacity"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")||$(elementData[a]).slideUp({duration:100});else for(var a in elementData)"color"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")&&"opacity"!=elementData[a].childNodes[1].childNodes[0].getAttribute("data")||$(elementData[a]).slideDown({duration:100})}var wrapper=document.getElementById("wrapper"),settings={},elementData=[],db=new Db,counter=0;console.log("Waiting for db ..."),init();